/*! For license information please see background.js.LICENSE.txt */
(()=>{var e={633:(e,t,r)=>{var n=r(738).default;function o(){"use strict";e.exports=o=function(){return r},e.exports.__esModule=!0,e.exports.default=e.exports;var t,r={},a=Object.prototype,i=a.hasOwnProperty,c=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",d=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(t){p=function(e,t,r){return e[t]=r}}function g(e,t,r,n){var o=t&&t.prototype instanceof x?t:x,a=Object.create(o.prototype),i=new F(n||[]);return c(a,"_invoke",{value:D(e,r,i)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}r.wrap=g;var m="suspendedStart",h="suspendedYield",b="executing",v="completed",y={};function x(){}function w(){}function k(){}var C={};p(C,u,(function(){return this}));var E=Object.getPrototypeOf,M=E&&E(E(A([])));M&&M!==a&&i.call(M,u)&&(C=M);var I=k.prototype=x.prototype=Object.create(C);function S(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function L(e,t){function r(o,a,c,s){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==n(d)&&i.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,c,s)}),(function(e){r("throw",e,c,s)})):t.resolve(d).then((function(e){l.value=e,c(l)}),(function(e){return r("throw",e,c,s)}))}s(u.arg)}var o;c(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(a,a):a()}})}function D(e,r,n){var o=m;return function(a,i){if(o===b)throw Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=T(c,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===m)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=b;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:h,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function T(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,T(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function F(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function A(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(i.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(n(e)+" is not iterable")}return w.prototype=k,c(I,"constructor",{value:k,configurable:!0}),c(k,"constructor",{value:w,configurable:!0}),w.displayName=p(k,d,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,p(e,d,"GeneratorFunction")),e.prototype=Object.create(I),e},r.awrap=function(e){return{__await:e}},S(L.prototype),p(L.prototype,l,(function(){return this})),r.AsyncIterator=L,r.async=function(e,t,n,o,a){void 0===a&&(a=Promise);var i=new L(g(e,t,n,o),a);return r.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(I),p(I,d,"Generator"),p(I,u,(function(){return this})),p(I,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},r.values=A,F.prototype={constructor:F,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(_),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:A(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},r}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},738:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},756:(e,t,r)=>{var n=r(633)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function t(t){return function(){var r=this,n=arguments;return new Promise((function(o,a){var i=t.apply(r,n);function c(t){e(i,o,a,c,s,"next",t)}function s(t){e(i,o,a,c,s,"throw",t)}c(void 0)}))}}var n=r(756),o=r.n(n);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var i={items:[],favorites:[]},c="",s=!1,u=null,l=!1,d=null,p=!1,g=100,f=1e4,m=1e3,h=!0,b=function(){var e=t(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Initializing Clipboard Manager background script"),e.next=4,chrome.storage.sync.get("settings");case 4:return(t=e.sent)&&t.settings&&(l=t.settings.enableVerboseLogging||!1,f=t.settings.maxTextLength||DEFAULT_MAX_TEXT_LENGTH,K("Settings loaded:",t.settings)),e.next=8,R();case 8:return v(),I(),chrome.action.onClicked.addListener((function(){chrome.tabs.create({url:"index.html"})})),setTimeout((function(){console.log("=== Clipboard Manager Diagnostics ==="),console.log("Active clipboard monitoring: ".concat(null!==d?"YES":"NO")),console.log("Check interval active: ".concat(d?"YES":"NO")),console.log("Clipboard items loaded: ".concat(i.items.length)),console.log("Last clipboard text: ".concat(c?"Present":"None"," (").concat(c?c.substring(0,20)+"...":"",")")),console.log("Testing message broadcast system...");var e={action:"clipboardManagerDiagnostic",timestamp:Date.now()};chrome.runtime.sendMessage(e,(function(e){chrome.runtime.lastError?console.log("No UI connected yet - this is normal if no popup/floating window is open"):e?console.log("Message system working:",e):console.log("Message sent but no response received")})),console.log("================================")}),5e3),console.log("Clipboard Manager background script initialized successfully"),e.abrupt("return",!0);case 16:return e.prev=16,e.t0=e.catch(0),console.error("Error initializing background script:",e.t0),e.abrupt("return",!1);case 20:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),v=function(){d&&clearInterval(d),d=setInterval(y,2e3),K("Clipboard monitoring started")},y=function(){var e=t(o().mark((function e(){var t,r,n,a,i,u,l,d,p,g=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=g.length>0&&void 0!==g[0]&&g[0],!s){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,s=!0,K("Checking clipboard for changes, force =",t),e.next=8,chrome.tabs.query({active:!0,currentWindow:!0});case 8:if((r=e.sent)&&0!==r.length){e.next=13;break}return K("No active tab found, skipping clipboard check"),s=!1,e.abrupt("return");case 13:if(n=r[0],!O(n.url)){e.next=18;break}return K("Restricted URL, skipping clipboard check:",n.url),s=!1,e.abrupt("return");case 18:return K("Reading clipboard from tab:",n.title),e.prev=19,e.next=22,chrome.scripting.executeScript({target:{tabId:n.id},func:function(e){return function(){try{(!0===window.forceClipboardCheck||!0===e)&&(console.log("[Clipboard Manager] Forcing clipboard read after copy/paste event:",e),window.forceClipboardCheck=!1);var t={success:!0,text:null,skipReason:null,error:null},r=window.getClipboardManagerState?window.getClipboardManagerState():null;if(r&&(r.justCopied||r.copyKeyPressed||r.pasteKeyPressed))console.log("[Clipboard Manager] Reading clipboard immediately after copy/paste event");else{var n=document.activeElement;if(n&&("INPUT"===n.tagName||"TEXTAREA"===n.tagName||n.isContentEditable)&&document.hasFocus()&&n===document.querySelector(":focus")&&!e)return console.log("[Clipboard Manager] Skipping clipboard read - user is typing"),t.skipReason="user_typing",t;try{var o=window.getSelection(),a=r&&(!0===r.copyKeyPressed||!0===r.pasteKeyPressed);if(!e&&o&&!o.isCollapsed&&""!==o.toString().trim()&&!a)return console.log("[Clipboard Manager] Skipping clipboard read - user has active text selection and no copy/paste key was pressed"),t.skipReason="active_selection",t;a&&console.log("[Clipboard Manager] Processing clipboard despite selection - copy or paste key was pressed")}catch(e){console.error("[Clipboard Manager] Error checking selection:",e)}try{if(!e&&document.querySelector(":active"))return console.log("[Clipboard Manager] Skipping clipboard read - mouse or key activity detected"),t.skipReason="active_interaction",t}catch(e){console.error("[Clipboard Manager] Error checking active elements:",e)}}try{if(navigator.clipboard&&"function"==typeof navigator.clipboard.readText)return console.log("[Clipboard Manager] Using Clipboard API"),t.useClipboardAPI=!0,t;console.log("[Clipboard Manager] Falling back to execCommand paste");var i=document.createElement("textarea");i.style.position="fixed",i.style.left="-999999px",i.style.top="-999999px",i.setAttribute("readonly","true"),document.body.appendChild(i);var c=document.activeElement,s=null;window.getSelection&&(s=window.getSelection());var u=null,l=null;c&&"selectionStart"in c&&(u=c.selectionStart,l=c.selectionEnd),i.focus({preventScroll:!0});var d=!1;try{d=document.execCommand("paste")}catch(e){console.error("[Clipboard Manager] Error during paste command:",e)}var p=i.value;return document.body.removeChild(i),s&&(s.removeAllRanges(),s.rangeCount>0&&s.addRange(s.getRangeAt(0))),c&&(c.focus({preventScroll:!0}),null!==u&&null!==l&&(c.selectionStart=u,c.selectionEnd=l)),d?console.log("[Clipboard Manager] Successfully read clipboard content"):console.log("[Clipboard Manager] Failed to read clipboard content with execCommand"),t.text=p,t.success=d,t}catch(e){return console.error("[Clipboard Manager] Error reading clipboard content:",e),t.error=e.message,t}}catch(e){return console.error("[Clipboard Manager] Critical error reading clipboard:",e),{success:!1,text:null,skipReason:null,error:e.message||"Unknown error"}}}()},args:[t]}).catch((function(e){return console.error("Failed to execute script:",e),[{result:{success:!1,text:null,skipReason:null,error:e.message||"Script execution failed"}}]}));case 22:if((i=e.sent)&&0!==i.length){e.next=27;break}return K("No clipboard results returned from content script"),s=!1,e.abrupt("return");case 27:if(u=(null===(a=i[0])||void 0===a?void 0:a.result)||{success:!1,text:null,skipReason:null,error:"No result data"},K("Clipboard result from page:",u),!u.skipReason){e.next=33;break}return K("Skipping clipboard processing because:",u.skipReason),s=!1,e.abrupt("return");case 33:if(!u.error){e.next=37;break}return console.error("Error reading clipboard:",u.error),s=!1,e.abrupt("return");case 37:if(!u.useClipboardAPI){e.next=60;break}return K("Content script suggested API, trying alternative method"),e.prev=39,e.next=42,chrome.scripting.executeScript({target:{tabId:n.id},func:function(){return new Promise((function(e){try{var t=document.createElement("textarea");t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),document.execCommand("paste");var r=t.value;document.body.removeChild(t),e({success:!0,text:r})}catch(t){e({success:!1,error:t.message})}}))}});case 42:if(!((l=e.sent)&&l[0]&&l[0].result)){e.next=53;break}if(!(d=l[0].result).success||!d.text){e.next=53;break}if(K("Got clipboard content from alternative method:",d.text.substring(0,50)+"..."),d.text===c){e.next=52;break}return e.next=50,x(d.text);case 50:e.next=53;break;case 52:K("Content unchanged, skipping");case 53:e.next=58;break;case 55:e.prev=55,e.t0=e.catch(39),console.error("Error with alternative clipboard method:",e.t0);case 58:e.next=70;break;case 60:if(void 0===u.text){e.next=70;break}if(p=u.text,K("Clipboard text from page:",p?p.substring(0,50)+"...":"empty"),!p||p===c){e.next=69;break}return K("Processing new clipboard content from page"),e.next=67,x(p);case 67:e.next=70;break;case 69:K("No new content detected from page");case 70:return e.next=72,C();case 72:e.next=77;break;case 74:e.prev=74,e.t1=e.catch(19),console.error("Error reading clipboard from page:",e.t1);case 77:return e.prev=77,s=!1,e.finish(77);case 80:e.next=86;break;case 82:e.prev=82,e.t2=e.catch(3),console.error("Error checking clipboard:",e.t2),s=!1;case 86:case"end":return e.stop()}}),e,null,[[3,82],[19,74,77,80],[39,55]])})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=t(o().mark((function e(t){var r,n,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t&&""!==t.trim()){e.next=4;break}return console.log("Background: Skipping empty content"),e.abrupt("return");case 4:if(t!==c){e.next=7;break}return console.log("Background: Skipping duplicate content (exact match)"),e.abrupt("return");case 7:if(!(t.length>f)){e.next=11;break}return console.log("Background: Content exceeds maximum length (".concat(t.length," > ").concat(f,"), skipping")),B({type:"warning",message:"Text exceeds maximum length (".concat(Math.round(t.length/1e3),"K > ").concat(Math.round(f/1e3),"K chars)")}),e.abrupt("return");case 11:return c=t,r=k(t),console.log("Background: Processing new clipboard content: type=".concat(r,", length=").concat(t.length,', preview="').concat(t.substring(0,30)).concat(t.length>30?"...":"",'"')),n={id:j(),content:t,type:r,timestamp:Date.now(),isFavorite:!1,charCount:t.length},-1!==(a=i.items.findIndex((function(e){return e.content===t})))&&(i.items.splice(a,1),console.log("Background: Item already exists, moving to top of history")),i.items.unshift(n),s=g,i.items.length>s&&(console.log("Background: Trimming history to ".concat(s," items")),i.items=i.items.slice(0,s)),e.next=22,T();case 22:return console.log("Background: Clipboard content processed successfully, broadcasting update"),w(),e.abrupt("return",n);case 27:return e.prev=27,e.t0=e.catch(0),console.error("Background: Error processing clipboard content:",e.t0),e.abrupt("return",null);case 31:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t){return e.apply(this,arguments)}}(),w=function(){try{console.log("Broadcasting clipboard update to all UI instances");var e=null!==u,t=!1,r=function(e,r){console.log("Sending ".concat(r," message...")),chrome.runtime.sendMessage(e,(function(n){if(chrome.runtime.lastError){var o=chrome.runtime.lastError.message;o.includes("Receiving end does not exist")||o.includes("message port closed")?(a=r,t||(console.log("Message broadcast: No active receivers (".concat(a,"). This is normal when no UI is open.")),t=!0)):console.warn("Error in ".concat(r,":"),o)}else n&&(console.log("[Clipboard Manager] ".concat(r," successfully received by UI:"),n),n.received&&!e.includesData&&setTimeout((function(){chrome.runtime.sendMessage({action:"fullClipboardData",timestamp:Date.now(),data:i,includesData:!0},(function(e){!chrome.runtime.lastError&&e&&console.log("Full clipboard data sent successfully")}))}),50));var a}))};if(console.log("Broadcasting updates. Active windows: ".concat(e)),r({action:"clipboardDataUpdated",timestamp:Date.now()},"standard update"),r({action:"clipboardUpdated",timestamp:Date.now()},"clipboardUpdated message"),r({action:"refreshClipboardData",timestamp:Date.now()},"refresh message"),u)try{chrome.windows.get(u,(function(e){!chrome.runtime.lastError&&e&&r({action:"forceRefreshData",target:"floating",timestamp:Date.now()},"direct floating window message")}))}catch(e){console.warn("Could not send direct message to floating window:",e)}}catch(e){console.error("Error in broadcast function:",e)}},k=function(e){if(!e||""===e.trim())return"text";if(e.startsWith("data:image/"))return"image";if(/^(https?:\/\/|www\.)[^\s/$.?#].[^\s]*$/i.test(e.trim()))return"url";try{for(var t=0,r=0,n=["{","}","()","=>",";","function","class","const","let","var","if","else","for","while","switch","import","export","return","async","await","<div","<span","<p","<a","</div>","</span>","</p>","</a>","/*","*/","//","#include","def ","public","private","protected"];r<n.length;r++){var o=n[r];e.includes(o)&&t++}var a=e.split("\n"),i=a.filter((function(e){return e.startsWith("  ")||e.startsWith("\t")}));if(t>=3||a.length>3&&i.length>1)return"code"}catch(e){}return"text"},C=function(){var e=t(o().mark((function e(){var t,r,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,chrome.tabs.query({active:!0,currentWindow:!0});case 3:if((t=e.sent)&&0!==t.length){e.next=7;break}return K("No active tab found, skipping image check"),e.abrupt("return",null);case 7:if(r=t[0],!O(r.url)){e.next=11;break}return K("Restricted URL, skipping image check:",r.url),e.abrupt("return",null);case 11:return e.prev=11,K("Attempting to check for clipboard image in tab",r.id),e.next=15,chrome.scripting.executeScript({target:{tabId:r.id},func:E,args:[]});case 15:if(n=e.sent){e.next=19;break}return K("No results from image check script"),e.abrupt("return",null);case 19:if(n.length){e.next=22;break}return K("Empty results array from image check script"),e.abrupt("return",null);case 22:if(n[0]){e.next=25;break}return K("First result is null from image check script"),e.abrupt("return",null);case 25:if(a=n[0].result){e.next=29;break}return K("Result value is null or undefined from image check script"),e.abrupt("return",null);case 29:if(!a.error){e.next=32;break}return K("Error in image check:",a.error),e.abrupt("return",null);case 32:if(!a.skipReason){e.next=35;break}return K("Skipping image processing due to:",a.skipReason),e.abrupt("return",null);case 35:return a.imageDetected?K("Image detected in clipboard"):K("No image detected in clipboard"),e.abrupt("return",a);case 39:return e.prev=39,e.t0=e.catch(11),console.error("Error executing image check script:",e.t0),e.abrupt("return",null);case 43:e.next=49;break;case 45:return e.prev=45,e.t1=e.catch(0),console.error("Error in checkForImageData:",e.t1),e.abrupt("return",null);case 49:case"end":return e.stop()}}),e,null,[[0,45],[11,39]])})));return function(){return e.apply(this,arguments)}}();function E(){try{var e=function(e){return Object.assign({success:!0,imageDetected:!1,skipReason:null,error:null},e||{})},t=document.activeElement;if(t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable)&&document.hasFocus())return console.log("[Clipboard Manager] Skipping image read - user is typing"),e({skipReason:"user_typing"});var r=function(){try{return window.getSelection()||null}catch(e){return console.error("[Clipboard Manager] Error accessing selection:",e),null}}();if(r&&!r.isCollapsed&&""!==r.toString().trim())return console.log("[Clipboard Manager] Skipping image read - active selection"),e({skipReason:"active_selection"});var n=document.createElement("div");if(n.contentEditable=!0,n.style.position="fixed",n.style.left="-99999px",n.style.top="-99999px",!document.body)return console.log("[Clipboard Manager] No document body found"),e({skipReason:"no_document_body"});document.body.appendChild(n);var o=!1;try{n.focus(),n.addEventListener("paste",(function(e){try{if(!e||!e.clipboardData||!e.clipboardData.items)return;var t,r=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){s=!0,i=e},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw i}}}}(e.clipboardData.items);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.type&&0===n.type.indexOf("image")){o=!0;try{var i=n.getAsFile();if(i){var c=new FileReader;c.onload=function(e){if(e&&e.target&&e.target.result)try{chrome.runtime.sendMessage({action:"clipboardImageDetected",content:e.target.result})}catch(e){console.error("[Clipboard Manager] Error sending image data:",e)}},c.readAsDataURL(i)}}catch(e){console.error("[Clipboard Manager] Error processing file:",e)}break}}}catch(e){r.e(e)}finally{r.f()}}catch(e){console.error("[Clipboard Manager] Error in paste handler:",e)}})),document.execCommand("paste")}catch(e){console.error("[Clipboard Manager] Error executing paste command:",e)}finally{setTimeout((function(){try{n&&n.parentNode&&n.parentNode.removeChild(n)}catch(e){console.error("[Clipboard Manager] Error cleaning up div:",e)}}),100)}return e({imageDetected:o})}catch(e){return console.error("[Clipboard Manager] Error in checkForImageInPage:",e),{success:!1,error:e.message||"Unknown error",imageDetected:!1}}}var M=function(){var e=t(o().mark((function e(t){var r,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t&&t.startsWith("data:image/")){e.next=4;break}return console.warn("Background: Invalid image data"),e.abrupt("return");case 4:if(!i.items.some((function(e){return e.content===t}))){e.next=7;break}return console.log("Background: Duplicate image, skipping"),e.abrupt("return");case 7:if(r=Math.round(t.length/1024),console.log("Background: Processing clipboard image, size:",r+"KB"),!(r>m)){e.next=13;break}return console.log("Background: Image exceeds maximum size (".concat(r,"KB > ").concat(m,"KB), skipping")),B({type:"warning",message:"Image exceeds maximum size (".concat(r,"KB > ").concat(m,"KB)")}),e.abrupt("return");case 13:return n={id:j(),content:t,type:"image",timestamp:Date.now(),isFavorite:!1,charCount:r+"KB"},i.items.unshift(n),a=g,i.items.length>a&&(console.log("Background: Trimming history to ".concat(a," items")),i.items=i.items.slice(0,a)),e.next=19,T();case 19:chrome.runtime.sendMessage({action:"clipboardDataUpdated"}),console.log("Background: Clipboard image saved"),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),console.error("Error processing clipboard image:",e.t0);case 26:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t){return e.apply(this,arguments)}}(),I=function(){try{chrome.contextMenus.removeAll(),chrome.contextMenus.create({id:"clipboard-manager",title:"Clipboard Manager",contexts:["editable"]}),i.favorites.slice(0,10).forEach((function(e,t){var r=e.content;r.length>50&&(r=r.substring(0,47)+"..."),chrome.contextMenus.create({id:"favorite-".concat(e.id),parentId:"clipboard-manager",title:r,contexts:["editable"]})})),chrome.contextMenus.create({id:"separator",parentId:"clipboard-manager",type:"separator",contexts:["editable"]}),chrome.contextMenus.create({id:"floating-window",parentId:"clipboard-manager",title:"Open Floating Window",contexts:["editable"]}),chrome.contextMenus.onClicked.addListener(S),K("Context menus created")}catch(e){console.error("Error setting up context menus:",e)}},S=function(){var e=t(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{"floating-window"===t.menuItemId?L():t.menuItemId.startsWith("favorite-")&&(n=t.menuItemId.replace("favorite-",""),(a=i.favorites.find((function(e){return e.id===n})))&&chrome.tabs.sendMessage(r.id,{action:"pasteContent",content:a.content}))}catch(e){console.error("Error handling context menu click:",e)}case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),L=function(){var e=t(o().mark((function e(){var t,r,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!u){e.next=16;break}return e.prev=2,e.next=5,chrome.windows.get(u);case 5:if(!e.sent){e.next=10;break}return e.next=9,chrome.windows.update(u,{focused:!0});case 9:return e.abrupt("return",{success:!0,message:"Focused existing floating window"});case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.log("Previous floating window not found, creating new one"),u=null;case 16:if(t=1366,e.prev=18,!chrome.system||!chrome.system.display){e.next=24;break}return e.next=22,chrome.system.display.getInfo();case 22:(r=e.sent)&&r.length>0&&(n=r[0],t=n.bounds.width,n.bounds.height);case 24:e.next=29;break;case 26:e.prev=26,e.t1=e.catch(18),console.warn("Could not get screen dimensions:",e.t1);case 29:return e.next=31,chrome.windows.create({url:chrome.runtime.getURL("popup.html"),type:"popup",width:400,height:550,left:Math.round(t-400-20),top:50,focused:!0});case 31:return a=e.sent,u=a.id,chrome.windows.onRemoved.hasListener(D)||chrome.windows.onRemoved.addListener(D),K("Floating window opened"),e.abrupt("return",{success:!0});case 38:return e.prev=38,e.t2=e.catch(0),console.error("Error opening floating window:",e.t2),e.abrupt("return",{error:e.t2.message});case 42:case"end":return e.stop()}}),e,null,[[0,38],[2,12],[18,26]])})));return function(){return e.apply(this,arguments)}}(),D=function(e){e===u&&(u=null,chrome.windows.onRemoved.removeListener(D))},T=function(){var e=t(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,K("Saving clipboard data to storage..."),K("Items to save:",i.items.length),t={items:i.items.map((function(e){return{id:e.id,content:e.content,type:e.type,timestamp:e.timestamp,isFavorite:e.isFavorite,charCount:e.charCount}})),favorites:i.favorites.map((function(e){return{id:e.id,content:e.content,type:e.type,timestamp:e.timestamp,isFavorite:e.isFavorite,charCount:e.charCount}}))},e.next=6,chrome.storage.local.set({clipboardData:t});case 6:return e.next=8,chrome.storage.local.get("clipboardData");case 8:if(!((r=e.sent)&&r.clipboardData&&Array.isArray(r.clipboardData.items))){e.next=14;break}return K("Clipboard data successfully saved, items:",r.clipboardData.items.length),e.abrupt("return",{success:!0,savedItems:r.clipboardData.items.length});case 14:return console.error("Failed to verify saved clipboard data"),e.abrupt("return",{success:!1,error:"Verification failed"});case 16:e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(0),console.error("Error saving clipboard data:",e.t0),e.abrupt("return",{success:!1,error:e.t0.message});case 22:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=t(o().mark((function e(){var t,r,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Background: Loading clipboard data and settings..."),e.next=4,chrome.storage.local.get("clipboardData");case 4:return(t=e.sent).clipboardData?(i=t.clipboardData,console.log("Background: Loaded clipboard data, items:",i.items.length)):(i={items:[],favorites:[]},console.log("Background: No clipboard data found, initialized empty data")),e.next=8,chrome.storage.local.get("settings");case 8:if(!(r=e.sent).settings){e.next=19;break}n=r.settings,l=n.verboseLogging||!1,g=n.maxItems||50,f=n.maxTextLength||1e4,m=n.maxImageSize||1e3,h=void 0===n.showCharCount||n.showCharCount,console.log("Background: Loaded settings:",{verboseLogging:l,MAX_HISTORY_ITEMS:g,maxTextLength:f,maxImageSize:m,showCharCount:h}),e.next=24;break;case 19:return console.log("Background: No settings found, using defaults"),a={verboseLogging:!1,maxItems:g,theme:"dark",showCharCount:!0,maxTextLength:1e4,maxImageSize:1e3},e.next=23,chrome.storage.local.set({settings:a});case 23:console.log("Background: Saved default settings");case 24:return e.abrupt("return",!0);case 27:return e.prev=27,e.t0=e.catch(0),console.error("Error loading clipboard data:",e.t0),e.abrupt("return",!1);case 31:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=t(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,-1===(r=i.items.findIndex((function(e){return e.id===t})))){e.next=8;break}return i.items[r].isFavorite=!i.items[r].isFavorite,i.favorites=i.items.filter((function(e){return e.isFavorite})),e.next=7,T();case 7:return e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 11:return e.prev=11,e.t0=e.catch(0),console.error("Error toggling favorite:",e.t0),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=t(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i.items=i.items.filter((function(e){return e.id!==t})),i.favorites=i.favorites.filter((function(e){return e.id!==t})),e.next=5,T();case 5:return e.abrupt("return",!0);case 8:return e.prev=8,e.t0=e.catch(0),console.error("Error deleting item:",e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=t(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={id:j(),content:t.content,type:t.type||k(t.content),timestamp:Date.now(),isFavorite:t.isFavorite||!1,charCount:t.content.length},i.items.unshift(r),r.isFavorite&&i.favorites.unshift(r),i.items.length>g&&(console.log("Background: Trimming history to ".concat(g," items")),i.items=i.items.slice(0,g)),e.next=7,T();case 7:return e.abrupt("return",r);case 10:return e.prev=10,e.t0=e.catch(0),console.error("Error adding new item:",e.t0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i={items:[],favorites:[]},e.next=4,T();case 4:return e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error clearing clipboard history:",e.t0),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=t(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=i.items.findIndex((function(e){return e.id===t})),-1!==r){e.next=4;break}throw new Error("Item not found");case 4:if(0!==r){e.next=6;break}return e.abrupt("return",!0);case 6:return n=i.items[r],i.items.splice(r,1),i.items.unshift(n),i.items[0].timestamp=Date.now(),e.next=12,T();case 12:return chrome.runtime.sendMessage({action:"clipboardDataUpdated"}),e.abrupt("return",!0);case 16:return e.prev=16,e.t0=e.catch(0),console.error("Error moving item to top:",e.t0),e.abrupt("return",!1);case 20:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),B=function(e){try{return chrome.runtime.sendMessage({action:"showNotification",notification:e}),!0}catch(e){return console.error("Error showing notification:",e),!1}},U=function(){var e=t(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t&&Array.isArray(t)&&0!==t.length){e.next=3;break}return e.abrupt("return",{success:!1,error:"No items to delete"});case 3:return i.items=i.items.filter((function(e){return!t.includes(e.id)})),r=new Set(t),n=i.favorites.filter((function(e){return!r.has(e.id)})),i.favorites=n,e.next=9,T();case 9:return chrome.runtime.sendMessage({action:"clipboardDataUpdated"}),e.abrupt("return",{success:!0,deletedCount:t.length});case 13:return e.prev=13,e.t0=e.catch(0),console.error("Error deleting multiple items:",e.t0),e.abrupt("return",{success:!1,error:e.t0.message});case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}();chrome.runtime.onMessage.addListener((function(e,t,r){try{var n=l;if(l=!0,K("Message received:",e),!e||!e.action)return K("Invalid message received (no action)"),r({error:"Invalid message"}),l=n,!0;switch(e.action){case"getClipboardData":K("Sending clipboard data to caller, items:",i.items.length),r(i);break;case"copyKeyDetected":!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();K("Copy key detection received, hasSelection:",e,"timestamp:",t),Date.now(),p=!0,setTimeout((function(){K("Performing forced clipboard check after copy key detection"),y(!0)}),100),setTimeout((function(){p&&(K("Performing second forced clipboard check"),y(!0),p=!1)}),500)}(e.hasSelection,e.timestamp),r({success:!0});break;case"pasteKeyDetected":K("Paste key detection received, hasSelection:",e.hasSelection,"timestamp:",e.timestamp),p=!0,setTimeout((function(){K("Performing forced clipboard check after paste key detection"),y(!0)}),100),setTimeout((function(){p&&(K("Performing second forced clipboard check after paste"),y(!0),p=!1)}),500),r({success:!0});break;case"clipboardImageDetected":return K("Image data detected, processing..."),M(e.content).then((function(){r({success:!0})})).catch((function(e){console.error("Error processing clipboard image:",e),r({error:e.message})})),!0;case"clipboardDataUpdated":chrome.runtime.sendMessage({action:"refreshClipboardData"}),r({success:!0});break;case"toggleFavorite":return _(e.itemId).then((function(e){r(e)})).catch((function(e){console.error("Error toggling favorite:",e),r({error:e.message})})),!0;case"deleteItem":return F(e.itemId).then((function(e){r(e)})).catch((function(e){console.error("Error deleting item:",e),r({error:e.message})})),!0;case"addNewItem":return A(e.item).then((function(e){r(e)})).catch((function(e){console.error("Error adding item:",e),r({error:e.message})})),!0;case"clearAll":return N().then((function(e){r(e)})).catch((function(e){console.error("Error clearing clipboard history:",e),r({error:e.message})})),!0;case"toggleVerboseLogging":l=e.enabled,chrome.storage.local.set({verboseLogging:l}),K("Verbose logging "+(l?"enabled":"disabled")),r({success:!0});break;case"pasteToActiveElement":K("Forwarding paste request to content script"),t.tab?(chrome.tabs.sendMessage(t.tab.id,{action:"pasteContent",content:e.content}),r({success:!0})):r({error:"Cannot paste in this context"});break;case"showNotification":B(e.notification),r({success:!0});break;case"openFloatingWindow":return L().then((function(){r({success:!0})})).catch((function(e){console.error("Error opening floating window:",e),r({error:e.message})})),!0;case"clipboardContent":return x(e.content).then((function(){r({success:!0})})).catch((function(e){console.error("Error processing clipboard content:",e),r({error:e.message})})),!0;case"moveItemToTop":return P(e.itemId).then((function(e){r(e)})).catch((function(e){console.error("Error moving item to top:",e),r({error:e.message})})),!0;case"deleteMultipleItems":return U(e.itemIds).then((function(e){r(e)})).catch((function(e){console.error("Error deleting multiple items:",e),r({error:e.message})})),!0;case"settingsUpdated":e.settings&&(l=e.settings.verboseLogging||!1,g=e.settings.maxItems||50,f=e.settings.maxTextLength||1e4,m=e.settings.maxImageSize||1e3,h=void 0===e.settings.showCharCount||e.settings.showCharCount,console.log("Background: Settings updated:",{verboseLogging:l,MAX_HISTORY_ITEMS:g,maxTextLength:f,maxImageSize:m,showCharCount:h}),chrome.storage.local.set({settings:e.settings},(function(){console.log("Background: Settings saved to storage")})),chrome.runtime.sendMessage({action:"settingsUpdated",settings:e.settings})),r({success:!0});break;default:K("Unknown action:",e.action),r({error:"Unknown action"})}l=n}catch(e){console.error("Error handling message:",e),r({error:e.message})}return!0}));var O=function(e){if(!e)return!0;try{var t=new URL(e);return["chrome:","chrome-extension:","chrome-search:","edge:","devtools:","about:","data:","file:","view-source:"].some((function(e){return t.protocol.startsWith(e)}))}catch(e){return!0}},j=function(){return Date.now().toString(36)+Math.random().toString(36).substring(2)},K=function(){if(l){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).log.apply(e,["[Clipboard Manager]"].concat(r))}};chrome.runtime.onInstalled.addListener(b),chrome.runtime.onStartup.addListener(b),chrome.runtime.onSuspend.addListener((function(){d&&clearInterval(d),K("Extension suspended")}))})()})();